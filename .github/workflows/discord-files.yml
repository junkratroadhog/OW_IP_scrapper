name: Upload Root Scripts to Discord

on:
  push:
    branches:
      - main

jobs:
  send-to-discord:
    runs-on: ubuntu-latest

    steps:
    - name: Checkout repository
      uses: actions/checkout@v3
      with:
        fetch-depth: 0  # ensures full Git history if needed

    - name: Upload root scripts to Discord
      env:
        DISCORD_WEBHOOK: ${{ secrets.DISCORD_WEBHOOK }}
      run: |
        # Find .ps1 and .bat files only in the repo root, case-insensitive
        FILES=$(find . -maxdepth 1 -type f \( -iname "*.ps1" -o -iname "*.bat" \) -printf "%f\n")

        if [ -z "$FILES" ]; then
          echo "No .ps1 or .bat files found in the root folder."
          exit 0
        fi

        # Upload each file individually
        for FILE in $FILES; do
          echo "Uploading $FILE..."
          curl -H "Content-Type: multipart/form-data" \
               -F "payload_json={\"content\": \"Repo updated â†’ sending $FILE\"}" \
               -F "file=@$FILE;type=application/octet-stream" \
               "$DISCORD_WEBHOOK"
          echo "$FILE uploaded successfully."
        done
